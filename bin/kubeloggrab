#!/bin/bash
NAMESPACE=$1
APP=$2
TIME_SINCE=$3
DATE=`date +"%m.%d.%y-%R"`


if [[ -z "$NAMESPACE" ]] || [[ -z $APP ]] || [[ -z $TIME_SINCE ]]; then
  echo "Ensure that namespace (option1), app (option2) and time since (option4) are all set"
  echo "exiting"
  exit 1
fi
#printing cluster-info
kubectl cluster-info

#printing pod info
echo "Attempting to find PODS for namesapce $NAMESPACE and app $APP"

kubectl get pods -n $NAMESPACE --selector=app=$APP | grep $APP
RC=$?

if [[ $RC != 0 ]]; then
  echo "error detected finding the pods, exiting"
  exit 1
fi

echo "Downloading logs for the PODS - outputting to $LOG_DIR/${APP}_${NAMESPACE}_${DATE}.log"
echo "Depending on the time since setting, this may take a few moments"

for i in `kubectl get pods -n $NAMESPACE --selector=app=$APP | grep $APP | awk '{print $1}'`; do kubectl logs $i -n $NAMESPACE --since $TIME_SINCE; done
